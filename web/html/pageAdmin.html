<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Page Admin</title>
    <link rel="icon" type="image/png" href="./web/assets/images/logo.png" />
    <link rel="stylesheet" href="./web/assets/css/materialize.min.css">
    <link rel="stylesheet" href="./web/assets/css/pageAdmin.css">
</head>
<body>
<div id="header">
    <h1>Page Admin</h1>
    <div id="logout">
        <a href="pageAdmin?logout">Logout</a>
    </div>
</div>
<div class="main">
    <div class="title">
        {{if eq .DefiActuel.Num 0}}
        <h2>Il n'y a pas de défi en cours</h2>
        {{else}}
        <h2>Défi actuel : défi n°{{.DefiActuel.Num}}</h2>
        <h2>Il a commencé le {{.DefiActuel.Date_debut}}
            et se termine le {{.DefiActuel.Date_fin}}</h2>
        {{end}}
    </div>
    <div class="separator"></div>
    <div class="row">
        <div class="col s12">
            <ul class="tabs">
                <li class="tab col s3"><a href="#up-defi">Déposer un défi</a></li>
                <li class="tab col {{if eq .DefiActuel.Num 0}} disabled {{end}} s3"><a href="#modif-date">Modifier la date</a></li>
                <li class="tab col {{if eq .DefiActuel.Num 0}} disabled {{end}} s3"><a href="#up-test">Déposer des test</a></li>
                <li class="tab col {{if eq .DefiActuel.Num 0}} disabled {{end}} s3"><a href="#liste-defi">Liste des défis</a></li>
                <li class="tab col s3"><a href="#logs">Logs</a></li>
            </ul>
        </div>
        <div id="up-defi" class="col s12">
            <h3>Enregistrer un défis avec sa correction, sa date de début et de fin.</h3>
            <h3>Il peut aussi servir à modifier le fichier de correction du défi actuel.</h3>
            <form enctype="multipart/form-data"  action="/pageAdmin?form=defi" method="post">
                <div class="file-depot">
                    <p>Dépot de la correction :</p>
                    <div class="chose-file" id="file-defi">
                        <label for="input-file-defi">
                            <img src="./web/assets/images/upload.png">
                            <p>Choisir un fichier</p>
                        </label>
                        <input type="file" name="upload" id="input-file-defi" required="required">
                    </div>
                </div>
                <div class="dates">
                    <div class="date-selector">
                        <p>Date de début :</p>
                        <input type="text" class="datepicker" name="date_debut" {{if ne .DefiActuel.Num 0}} value="{{.DefiActuel.Date_debut}}" {{end}}>
                    </div>
                    <div class="date-selector">
                        <p>Date de fin :</p>
                        <input type="text" class="datepicker" name="date_fin" {{if ne .DefiActuel.Num 0}} value="{{.DefiActuel.Date_fin}}" {{end}}>
                    </div>
                </div>
                <div>
                    <input type="submit" class="button" value="déposer" name="submit"/>
                    <input type="submit" class="button" value="modifier" name="submit"/>
                </div>
            </form>
        </div>
        <div id="modif-date" class="col s12">
            <h3>Modifier uniquement la date :</h3>
            <form action="/pageAdmin?form=modify_date" method="post">
                <p>Numéro du défi à modifer la date :</p>
                <select id="selectModifyDate" name="defiSelectModif" required="required" onchange="ChangeDateInput( event, 'modif-date')">
                    {{range .ListeDefis}}
                    <option value="{{.Num}}">{{.Num}}</option>
                    {{end}}
                </select>
                <div class="dates">
                    <div class="date-selector">
                        <p>Date de début :</p>
                        <input type="text" class="datepicker" name="date_debut" {{if ne .DefiActuel.Num 0}} value="{{.DefiActuel.Date_debut}}" {{end}}>
                    </div>
                    <div class="date-selector">
                        <p>Date de fin : </p>
                        <input type="text" class="datepicker"  name="date_fin" {{if ne .DefiActuel.Num 0}} value="{{.DefiActuel.Date_fin}}" {{end}}>
                    </div>
                </div>
                <input class="button" type="submit">
            </form>
        </div>
        <div id="up-test" class="col s12">
            <h3>Formulaire pour upload des tests : </h3>
            <div class="explication">
                <p>Les formats acceptés sont les .zip et les .tar</p>
                <p>l'archive doit comprendre à la racine les fichiers/dossiers servant au test et un fichier nommé "config"
                    contenant la liste des arguments pour chaque cas de test. Pas besoin de spécifier un nom à l'archive.</p>
                <p>Exemple de fichier config :</p>
                <p class="code">
                    fichier1 fichier2<br>
                    fichier2 test1/fichier3<br>
                    test1/fichier3 test2/oui/fichier4<br>
                    etc...</p>
            </div>
            <div>
                <form enctype="multipart/form-data" action="/pageAdmin?form=test" method="post">
                    <div>
                        Choisir un numéro de défi :
                        <select name="defiSelectTest" required="required">
                            {{range .ListeDefis}}
                            <option value="{{.Num}}">{{.Num}}</option>
                            {{end}}
                        </select>
                    </div>
                    <div class="file-depot">
                        <p>Dépot du test :</p>
                        <div class="chose-file" id="file-test">
                            <label for="input-file-test">
                                <img src="./web/assets/images/upload.png">
                                <p>Choisir un fichier</p></label>
                            <input type="file" name="upload" id="input-file-test" required="required">
                        </div>
                    </div>
                    <div>
                        <input type="submit" class="button" value="déposer" name="submit">
                    </div>
                </form>
            </div>
        </div>
        <div id="liste-defi" class="col s12">
            <h3>Liste des défis enregistrés : </h3>
            {{range .ListeDefis}}
            <p class="{{if eq $.DefiActuel.Num .Num}}red-actuel{{end}}">
                Défi n°{{.Num}} du {{.Date_debut}} au {{.Date_fin}}
                <a href="pageAdmin?Defi={{.Num}}">Afficher les participants</a></p>
            {{end}}
            {{if eq .DefiSelect.Num 0}}
            {{else}}
            <h4>Liste des participants au défi {{$.DefiSelect.Num}}</h4>
            {{if not .Participants}}
            <p>Aucun participants</p>
            {{end}}

            <!---{{range .Participants}}
                {{.Etudiant.Login}}
                Etat :
                {{if eq .Resultat.Etat 1}}
                    Réussi
                    {{else if eq .Resultat.Etat 0}}
                    Échoué
                {{end}}
            Nombre de tentative : {{.Resultat.Tentative}}
            <a href="pageAdmin?Defi={{$.DefiSelect.Num}}&Etudiant={{.Etudiant.Login}}">
                Afficher le script
            </a>
            <a href="pageAdmin?Defi={{$.DefiSelect.Num}}&Etudiant={{.Etudiant.Login}}&Etat={{.Resultat.Etat}}">
                Modifier l'état
            </a>
            <br>
            {{end}}---->
            {{if eq .Correcteur.Login ""}}
            <p>Choisir un étudiant correcteur : <button class="button"><a href="pageAdmin?Defi={{.DefiSelect.Num}}&Correcteur">choisir</a></button></p>
            {{else}}
            <p>Le correcteur est {{.Correcteur.Prenom}} {{.Correcteur.Nom}}</p>
            <p>Son mail est {{.Correcteur.Mail}}</p>
            {{end}}

            <table>
                <tbody>
                <tr>
                    <td>Étudiant</td>
                    <td>État</td>
                    <td>Nombre de tentative</td>
                    <td>Actions</td>
                </tr>
                {{range .Participants}}
                <tr>
                    <td>{{.Etudiant.Login}}</td>
                    <td>
                        {{if eq .Resultat.Etat 1}}
                        <span class="etat-text win">Réussi</span>
                        {{else if eq .Resultat.Etat 0}}
                        <span class="etat-text lose">Échoué</span>
                        {{end}}
                    </td>
                    <td>{{.Resultat.Tentative}}</td>
                    <td>
                        <a href="pageAdmin?Defi={{$.DefiSelect.Num}}&Etudiant={{.Etudiant.Login}}">
                            Afficher le script
                        </a>
                        |
                        <a href="pageAdmin?Defi={{$.DefiSelect.Num}}&Etudiant={{.Etudiant.Login}}&Etat={{.Resultat.Etat}}">
                            Modifier l'état
                        </a>
                    </td>
                </tr>
                {{end}}
                </tbody>
            </table>
            <div>
                Récupérer le résultat au format CSV : <button class="button"><a href="pageAdmin?Defi={{.DefiSelect.Num}}&getResult">Téléchager</a></button>
            </div>
            <div>
                Récupérer la liste des scripts similaires : <button class="button"><a href="pageAdmin?Defi={{.DefiSelect.Num}}&getIdentique">Check</a></button>
            </div>
            {{range .Tricheurs}}
            {{.}}
            {{end}}
            {{end}}
            <br>
            {{if .File}}
            <div>
                <h3>Contenu du script :</h3>
                <div id="file">
                    <p class="code">
                    {{range .File}}
                    {{.}} <br>
                    {{end}}
                    </p>
                </div>
            </div>
            {{end}}
        </div>
        <div id="logs" class="col s12">
            <h3>Logs :</h3>
            {{range .Logs}}
            <a href="pageAdmin?Log={{.}}">{{.}}</a><br>
            {{end}}
            <a href="pageAdmin">désélectionner</a>
            {{if .Log}}
            <div class="separator"></div>
            Contenu des logs du {{.LogDate}} : <br>
            <div>
                <table>
                    <tbody>
                    {{range .Log}}
                    <tr>
                        <td>
                            {{.}}
                        </td>
                    </tr>
                    {{end}}
                    </tbody>
                </table>
            </div>
            {{end}}
        </div>
    </div>
    <div class="separator"></div>
    <div id="mail">
        <h2>Envoyer le résultat par mail aux étudiants</h2>
        <form action="/pageAdmin?form=sendMail" method="post">
            <input type="submit" class="button" value="Envoyer Mail" name="submit">
        </form>
    </div>
</div>
<div id="footer">
    <p>Projet réalisé sous l'initiative de Loïg Jezequel</p>
    <p><a href="https://gitlab.univ-nantes.fr/E192543L/projet-s3/">
        <img src="./web/assets/images/gitlab-logo.png">
        GitLab du projet
    </a></p>
</div>
<script src="./web/assets/js/materialize.min.js"></script>
<script src="./web/assets/js/pageAdmin.js"></script>
</body>
</html>